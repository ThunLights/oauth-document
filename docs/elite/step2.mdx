---
sidebar_position: 2
title: Step2 codeからアカウント情報を取得
---

# codeからアカウント情報を取得

以下の二つの関数を用いることでcode -> アクセストークン -> アカウントデータの順番に変換できます。

詳しいレスポンスなどを見たい場合はconsole.logで確認するかエンドポイント一覧でご確認ください

### codeをアクセストークンに変換するコード
```ts
const secret = "";
const domain = encodeURIComponent("");

async function codeToAcccessToken(code: string) {
    const url = `https://oauth.thunlights.com/check/code/${code}`;

    const response = await fetch(`${url}?secret=${secret}&domain=${domain}`, {
        method: "POST",
    });

    if (response.ok) {
        return await response.json();
    }

    return null;
}
```

Response
```json
{
    "accessToken": "ACCESS_TOKEN",
    "refreshToken": "REFRESH_TOKEN"
}
```

### アクセストークンを元にアカウントデータを取得するコード
```ts
async function accessTokenToAccount(accessToken: string) {
    const response = await fetch(`https://oauth.thunlights.com/check/accessToken/${accessToken}`, {
        method: "POST",
    });

    if (response.ok) {
        return await response.json();
    }

    return null;
}
```

Response
```json
{
    "id": "ID",
    "txtId": "TXTID",
    "email": "EMAIL",
    "displayName": "DISPLAYNAME"
}
```

## 活用方法

上記の方法で取得できるアクセストークン、リフレッシュトークン、id、emailなどをデータベースに保存することによってより手軽にアカウントシステムが構築できると思います。

ThunLightsのアカウント登録は裏で色々なスパム対策をしており少人数チームのサイトとしては指折りだと自負しています。是非それを生かしていただければ幸いです。
